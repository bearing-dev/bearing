---
import { initScript } from 'sailkit/packages/lantern';
import ThemeToggle from 'sailkit/packages/lantern/ThemeToggle.astro';
import { getNeighbors } from 'sailkit/packages/compass';
import Sidebar from '../components/Sidebar.astro';
import PrevNext from '../components/PrevNext.astro';
import { navigation } from '../navigation';

interface Props {
  title: string;
  slug: string;
}

const { title, slug } = Astro.props;
const { prev, next } = getNeighbors(navigation, slug, { leavesOnly: true });
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title} - Bearing Docs</title>
    <script is:inline set:html={initScript} />
    <style is:global>
      :root {
        --color-bg: #ffffff;
        --color-text: #1a1a2e;
        --color-text-muted: #64748b;
        --color-sidebar-bg: #f8fafc;
        --color-border: #e2e8f0;
        --color-accent: #059669;
        --color-accent-hover: #047857;
        --color-accent-dim: rgba(5, 150, 105, 0.1);
        --color-code-bg: #f1f5f9;
        --sidebar-width: 260px;
        --header-height: 56px;
      }

      [data-theme="dark"] {
        --color-bg: #0f172a;
        --color-text: #f1f5f9;
        --color-text-muted: #94a3b8;
        --color-sidebar-bg: #1e293b;
        --color-border: #334155;
        --color-accent: #34d399;
        --color-accent-hover: #6ee7b7;
        --color-accent-dim: rgba(52, 211, 153, 0.15);
        --color-code-bg: #1e293b;
      }

      * { margin: 0; padding: 0; box-sizing: border-box; }

      html {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--color-bg);
        color: var(--color-text);
      }

      body {
        min-height: 100vh;
        display: grid;
        grid-template-columns: var(--sidebar-width) 1fr;
        grid-template-rows: var(--header-height) 1fr;
        grid-template-areas: "sidebar header" "sidebar main";
      }

      .header {
        grid-area: header;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 2rem;
        border-bottom: 1px solid var(--color-border);
        background: var(--color-bg);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header-title { font-size: 1rem; font-weight: 600; }

      .header-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
      }

      .github-link {
        color: var(--color-text-muted);
        display: flex;
        align-items: center;
        transition: color 0.2s;
      }

      .github-link:hover {
        color: var(--color-text);
      }

      .sidebar {
        grid-area: sidebar;
        background: var(--color-sidebar-bg);
        border-right: 1px solid var(--color-border);
        overflow-y: auto;
        position: sticky;
        top: 0;
        height: 100vh;
      }

      .sidebar-header {
        padding: 1rem 1.25rem;
        border-bottom: 1px solid var(--color-border);
      }

      .sidebar-logo {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--color-accent);
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .sidebar-logo:hover { color: var(--color-accent-hover); }

      .sidebar-logo svg {
        width: 24px;
        height: 24px;
      }

      .sidebar-logo svg path {
        stroke: var(--color-text-muted);
      }

      .sidebar-logo:hover svg path {
        stroke: var(--color-accent-hover);
      }

      main {
        grid-area: main;
        padding: 2rem 3rem;
        max-width: 800px;
        overflow-y: auto;
      }

      .content { line-height: 1.7; }
      .content h1 { font-size: 2rem; margin-bottom: 1.5rem; font-weight: 700; }
      .content h2 { font-size: 1.375rem; margin-top: 2rem; margin-bottom: 0.75rem; font-weight: 600; border-bottom: 1px solid var(--color-border); padding-bottom: 0.5rem; }
      .content h3 { font-size: 1.125rem; margin-top: 1.5rem; margin-bottom: 0.5rem; font-weight: 600; }
      .content p { margin-bottom: 1rem; }
      .content a { color: var(--color-accent); text-decoration: none; }
      .content a:hover { text-decoration: underline; }
      .content code { background: var(--color-code-bg); padding: 0.125rem 0.375rem; border-radius: 4px; font-family: ui-monospace, monospace; font-size: 0.875em; }
      .content pre { background: var(--color-code-bg); padding: 1rem; border-radius: 6px; overflow-x: auto; margin-bottom: 1rem; }
      .content pre code { background: none; padding: 0; }
      .content ul, .content ol { margin-bottom: 1rem; padding-left: 1.5rem; }
      .content li { margin-bottom: 0.5rem; }
      .content table { width: 100%; border-collapse: collapse; margin-bottom: 1.5rem; }
      .content th, .content td { padding: 0.5rem 0.75rem; text-align: left; border-bottom: 1px solid var(--color-border); }
      .content th { font-weight: 600; background: var(--color-sidebar-bg); }

      .hamburger { display: none; background: none; border: none; padding: 0.5rem; cursor: pointer; color: var(--color-text); }
      .hamburger svg { width: 24px; height: 24px; }
      .sidebar-overlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 199; }

      @media (max-width: 768px) {
        body { grid-template-columns: 1fr; grid-template-areas: "header" "main"; }
        .hamburger { display: block; }
        .sidebar { position: fixed; left: 0; top: 0; bottom: 0; z-index: 200; transform: translateX(-100%); transition: transform 0.3s ease; }
        .sidebar.open { transform: translateX(0); }
        .sidebar-overlay.open { display: block; }
        main { padding: 1.5rem; }
      }
    </style>
  </head>
  <body>
    <div class="sidebar-overlay" id="sidebar-overlay"></div>
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="/" class="sidebar-logo">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
            <path d="M 50 10 A 40 40 0 1 1 35 12" fill="none" stroke-width="6" stroke-linecap="round"/>
            <path d="M 78 65 A 28 28 0 1 1 85 45" fill="none" stroke-width="6" stroke-linecap="round"/>
            <path d="M 35 50 A 16 16 0 1 1 38 62" fill="none" stroke-width="6" stroke-linecap="round"/>
          </svg>
          Bearing
        </a>
      </div>
      <Sidebar currentSlug={slug} />
    </aside>

    <header class="header">
      <button class="hamburger" id="hamburger" aria-label="Toggle navigation">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M3 12h18M3 6h18M3 18h18" />
        </svg>
      </button>
      <h1 class="header-title">{title}</h1>
      <div class="header-actions">
        <a href="https://github.com/joshribakoff/bearing" class="github-link" target="_blank" rel="noopener" aria-label="View on GitHub">
          <svg viewBox="0 0 24 24" fill="currentColor" width="24" height="24">
            <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
          </svg>
        </a>
        <ThemeToggle />
      </div>
    </header>

    <main>
      <article class="content">
        <slot />
      </article>
      <PrevNext prev={prev} next={next} />
    </main>

    <script>
      const hamburger = document.getElementById('hamburger');
      const sidebar = document.getElementById('sidebar');
      const overlay = document.getElementById('sidebar-overlay');

      function toggle() {
        sidebar?.classList.toggle('open');
        overlay?.classList.toggle('open');
      }
      function close() {
        sidebar?.classList.remove('open');
        overlay?.classList.remove('open');
      }

      hamburger?.addEventListener('click', toggle);
      overlay?.addEventListener('click', close);
      sidebar?.querySelectorAll('a').forEach(link => link.addEventListener('click', close));
    </script>
  </body>
</html>
